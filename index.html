<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weevup - Organisation & Missions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        weevup: {
                            DEFAULT: '#005461',
                            dark: '#00414d',
                            light: '#006d7d',
                            soft: '#f0f7f8',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900 font-sans pb-20">

    <!-- HEADER -->
    <header class="bg-white border-b-4 border-weevup sticky top-0 z-40 px-6 py-4 shadow-md">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <div class="bg-weevup p-2 rounded-xl text-white shadow-inner flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 315.65 237.79" class="w-8 h-6 fill-current">
                        <g>
                            <path d="M15.52,41.28c0,.09.05.13.09.22l100.59,191.2c1.77,3.38,5.08,5.08,8.39,5.09h.03c3.29,0,6.57-1.68,8.36-5.04l13.64-25.58c-5.77,7.92-17.98,6.84-22.27-1.97L28.31,22c-.17,0-.34,0-.5,0-9.83,0-16.47,10.27-12.29,19.29"/>
                            <path d="M124.34,205.2c4.29,8.81,16.5,9.89,22.27,1.97l37.17-69.59-11.94-22.68-47.5,90.3Z"/>
                            <path d="M226.62,21.69c-3.53,0-6.8,1.97-8.41,5.05l-34.98,66.51,11.99,22.9,38.64-72.46h52.06c10.7,0,18.21,11.41,13.37,20.48l15.21-28.49c.77-1.43,1.13-2.92,1.14-4.38v-.21c-.06-4.94-4.03-9.41-9.5-9.41h-79.52Z"/>
                            <path d="M221.48,166.24c-4.21,8.59-16.01,9.62-21.65,1.92l13.46,25.63c3.58,6.75,13.24,6.75,16.82.04l69.19-129.66c5.12-9.6-3.09-20.48-13.37-20.48l-64.45,122.55Z"/>
                            <path d="M9.53,0C4.02,0,.03,4.5,0,9.44v.09c0,1.46.36,2.95,1.12,4.37l14.4,27.37c-4.25-9.17,2.68-19.64,12.79-19.28h94.68l48.84,92.9,11.94,22.68,16.06,30.59c5.64,7.69,17.44,6.66,21.65-1.92l-26.25-50.09-11.99-22.9L137.08,5.1c-1.65-3.13-4.92-5.1-8.45-5.1H9.53Z"/>
                        </g>
                    </svg>
                </div>
                <div>
                    <h1 class="text-2xl font-black tracking-tight uppercase text-weevup">Weevup <span class="text-slate-400">Orga</span></h1>
                    <p class="text-[10px] text-slate-500 font-black uppercase tracking-[0.3em]">Matrice Rôles & Missions</p>
                </div>
            </div>

            <div class="flex items-center gap-2 bg-slate-200 p-1.5 rounded-2xl" id="view-toggle">
                <button id="btn-process" class="flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-black transition-all bg-white shadow-md text-weevup">
                    <i data-lucide="clock" class="w-4 h-4"></i> PROCESSUS
                </button>
                <button id="btn-roles" class="flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-black transition-all text-slate-600 hover:text-weevup">
                    <i data-lucide="users" class="w-4 h-4"></i> PAR MEMBRE
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 mt-8">
        
        <!-- TOOLBAR -->
        <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-200 mb-8 flex flex-col md:flex-row gap-5">
            <div class="relative flex-1">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-weevup w-5 h-5 opacity-60"></i>
                <input 
                    type="text" 
                    id="search-input"
                    placeholder="Rechercher une mission, un outil ou une action..."
                    class="w-full pl-12 pr-4 py-3 bg-slate-50 border-2 border-slate-100 rounded-2xl text-sm font-medium focus:ring-4 focus:ring-weevup/10 focus:border-weevup outline-none transition-all"
                >
            </div>
            <div class="flex gap-2 overflow-x-auto pb-2 md:pb-0 scrollbar-hide" id="referent-filters">
                <!-- Person buttons injected here -->
            </div>
        </div>

        <!-- CONTENT AREA -->
        <div id="content-area">
            <!-- Dynamic content injected here -->
        </div>

        <!-- EMPTY STATE -->
        <div id="empty-state" class="hidden text-center py-24 bg-white rounded-3xl border-4 border-dashed border-slate-200">
            <div class="bg-slate-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-300">
                <i data-lucide="search-x" class="w-12 h-12"></i>
            </div>
            <h3 class="text-2xl font-black text-slate-800">Aucun résultat trouvé</h3>
            <p class="text-slate-500 font-medium">Modifiez vos filtres ou votre recherche pour voir les missions.</p>
        </div>
    </main>

    <!-- MOBILE FOOTER NAV -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-slate-100 p-4 z-40 md:hidden flex justify-around shadow-2xl">
         <button id="mobile-btn-process" class="flex flex-col items-center gap-1 text-weevup scale-110">
           <i data-lucide="layers" class="w-6 h-6"></i>
           <span class="text-[10px] font-black uppercase">Process</span>
         </button>
         <button id="mobile-btn-roles" class="flex flex-col items-center gap-1 text-slate-400">
           <i data-lucide="users" class="w-6 h-6"></i>
           <span class="text-[10px] font-black uppercase">Membres</span>
         </button>
    </div>

    <script>
        const rawData = [
          { phase: "PHASE 1 : ENTRÉE COMMERCIALE", color: "bg-[#005461]", light: "bg-[#005461]/10", border: "border-[#005461]", items: [
            { mission: "Demande entrante", referent: ["Julien", "Cheffe d'équipe"], actions: "Réseau, sortlist, formulaire, téléphone, prospection" },
            { mission: "Prise de brief", referent: ["Julien", "Cheffe d'équipe"] },
            { mission: "Qualification budget/timing", referent: ["Julien"], actions: "Confirmer faisabilité interne (charge / calendrier)" },
            { mission: "Création/ mise à jour CRM", referent: ["Julien"] },
            { mission: "Brief complet ?", referent: ["Julien"], ifNot: "↩️ Prise de brief" },
            { mission: "Go ? No go ?", referent: ["Julien"], ifNot: "↩️ Phase commerciale" },
            { mission: "Assignation Cheffe d'équipe", referent: ["Julien"], actions: "Vérifier charge + adéquation profil projet" }
          ]},
          { phase: "PHASE 2 : PRÉ-KICK OFF", color: "bg-sky-600", light: "bg-sky-50", border: "border-sky-600", items: [
            { mission: "Création du projet dans les outils", referent: ["Cheffe d'équipe"], actions: "Drive, canva, pipedrive, plateforme" },
            { mission: "Analyse contraintes & charge", referent: ["Cheffe d'équipe"], actions: "Identifier risques (budget, timing, lieu)" },
            { mission: "Prise de connaissance des éléments", referent: ["Équipe", "Pascal", "Simon", "Lead", "Cheffe d'équipe"] },
            { mission: "Définition directions d’expérience", referent: ["Simon"], actions: "2–3 caps clairs + Intégrer angle RSE dès la conception (mobilité, partenaires responsables, impact positif)" },
            { mission: "Repérage macro lieux / expériences", referent: ["Simon"], actions: "Vérifier critères RSE (local, accessibilité, prestas responsables)" },
            { mission: "Premières réflexions créatives", referent: ["Pascal"] },
            { mission: "Pistes stratégiques pour Kick off", referent: ["Simon"] }
          ]},
          { phase: "PHASE 3 : KICK OFF INTERNE", color: "bg-violet-600", light: "bg-violet-50", border: "border-violet-600", items: [
            { mission: "Fixation deadlines", referent: ["Cheffe d'équipe"], actions: "Créer rétroplanning, définir date de rendu" },
            { mission: "Répartition rôles & désignation Lead client", referent: ["Cheffe d'équipe"] },
            { mission: "Validation direction d’expérience", referent: ["Simon"] },
            { mission: "Partage des premières pistes de sourcing", referent: ["Simon"] },
            { mission: "Cadrage DA", referent: ["Pascal"] },
            { mission: "1er contact client pour le lead", referent: ["Julien", "Lead"], actions: "Caler une date de rendu et envoyer les questions" },
            { mission: "Post Kick off : établir le budget prévisionnel", referent: ["Lead", "Cheffe d'équipe", "Simon"] }
          ]},
          { phase: "PHASE 4 : SOURCING & NÉGOCIATION", color: "bg-pink-600", light: "bg-pink-50", border: "border-pink-600", items: [
            { mission: "Recherche partenaires", referent: ["Équipe", "Simon"], actions: "Prioriser partenaires engagés / locaux / responsables<br/>Veille individuelle + base interne" },
            { mission: "Déroulé prévisionnel", referent: ["Lead", "Simon"] },
            { mission: "Contacts prestataires + Demandes devis", referent: ["Équipe"], actions: "Mail type + personnalisation, <br/>MAJ Sourcing continu + centraliser dans le drive.<br/>Demander infos RSE (provenance, déchets, énergie, inclusion)" },
            { mission: "Relances & négociation tarifaire", referent: ["Équipe"] },
            { mission: "Échanges avec le client", referent: ["Lead", "Julien"] },
            { mission: "Supervision & arbitrage qualité/budget", referent: ["Cheffe d'équipe"], actions: "Intégrer critère RSE dans arbitrage, pas uniquement prix" },
            { mission: "Supervision stratégique + Sourcing conforme & faisable ?", referent: ["Simon"], ifNot: "↩️ Recherche partenaires", actions: "Choix des 2 propositions à présenter" }
          ]},
          { phase: "PHASE 5 : BUDGET & ARBITRAGES", color: "bg-orange-600", light: "bg-orange-50", border: "border-orange-600", items: [
            { mission: "Construction budget", referent: ["Équipe", "Lead"], actions: "Intégration honoraires & options<br/>Double relecture nécessaire équipe/lead" },
            { mission: "Co-construction budget", referent: ["Lead"] },
            { mission: "Validation interne qualité/cohérence/ budget", referent: ["Cheffe d'équipe"], actions: "Double contrôle erreurs" },
            { mission: "Validation marge", referent: ["Julien"] },
            { mission: "Arbitrage expérience vs budget", referent: ["Simon"], ifNot: "↩️ Construction budget" }
          ]},
          { phase: "PHASE 6 : PRODUCTION CANVA", color: "bg-emerald-600", light: "bg-emerald-50", border: "border-emerald-600", items: [
            { mission: "Production slides via modèles", referent: ["Équipe", "Lead"], actions: "Squelette complet avant mise en forme et remplissage" },
            { mission: "Intégration contenus complets", referent: ["Équipe"], actions: "Ajouter slide “Notes positives” systématique" },
            { mission: "Structuration storytelling & messages clés", referent: ["Lead", "Simon", "Pascal"], actions: "Mettre en avant expérience vécue + impact" },
            { mission: "Conception graphique & identité event", referent: ["Pascal"], actions: "Valoriser dimension émotionnelle et responsable" },
            { mission: "Supports / teaser / projections si besoin", referent: ["Pascal"] },
            { mission: "Validation qualité & complétude", referent: ["Cheffe d'équipe"], ifNot: "↩️ Production slides via modèles", actions: "Vérifier cohérence promesse expérience + RSE" },
            { mission: "Validation Pascal & Simon", referent: ["Simon", "Pascal"], ifNot: "↪️ Relecture fond & validation finale" }
          ]},
          { phase: "PHASE 7 : PRÉSENTATION & A/R", color: "bg-indigo-600", light: "bg-indigo-50", border: "border-indigo-600", items: [
            { mission: "Envoi proposition", referent: ["Lead", "Julien"], actions: "Inclure échéancier paiement client dans le budget client" },
            { mission: "Présentation client", referent: ["Lead", "Simon", "Cheffe d'équipe", "Julien"], actions: "Si nécessaire, créer présentation pour l'oral" },
            { mission: "Réception retours", referent: ["Lead"], actions: "Concertation interne" },
            { mission: "Modifications", referent: ["Équipe"] },
            { mission: "Renvoi", referent: ["Lead"] },
            { mission: "Refus ? Ajustements ? GO ?", referent: ["Client"], ifNot: "⛔ REX interne<br/>↩️ Modifications<br/>↪️ Phase suivante", actions: "⛔ Notification du refus aux prestataires" }
          ]},
          { phase: "PHASE 8 : FACTURATION & ADMINISTRATIF", color: "bg-rose-600", light: "bg-rose-50", border: "border-rose-600", items: [
            { mission: "Édition devis & CGV", referent: ["Marie", "Lead"], actions: "⚠️ Pas de production sans devis signé" },
            { mission: "Facture client & prestas", referent: ["Marie", "Lead"], actions: "Acomptes, Solde... En fonction de l'échéancier" },
            { mission: "Négociation post-signature client pour optimisation marge", referent: ["Équipe", "Cheffe d'équipe", "Simon"], actions: "Chercher économies" },
            { mission: "Informer les prestataires retenus", referent: ["Lead", "Équipe"], actions: "Formaliser par écrit" },
            { mission: "Notifier les prestataires non retenus", referent: ["Lead", "Équipe"] }
          ]},
          { phase: "PHASE 9 : PRODUCTION", color: "bg-teal-600", light: "bg-teal-50", border: "border-teal-600", items: [
            { mission: "Pilotage global", referent: ["Lead"] },
            { mission: "Supervision des process", referent: ["Cheffe d'équipe"] },
            { mission: "Suivi qualité de production", referent: ["Simon"] },
            { mission: "Repérage du lieu avec le client si vendu", referent: ["Lead"] },
            { mission: "Interface client", referent: ["Lead"] },
            { mission: "Coordination & logistique", referent: ["Équipe"], actions: "Suivi engagements RSE sur le terrain<br/>Boîte event, reconfirmations partenaires avec envoi déroulé" },
            { mission: "Organisation des VHR équipe", referent: ["Lead", "Cheffe d'équipe", "Marie"], actions: "Valider horaires, budgets, récup..." },
            { mission: "Carnet de bord", referent: ["Lead", "Cheffe d'équipe"], actions: "À valider avec la cheffe d'équipe avant envoi<br/>Intégrer points RSE opérationnels" }
          ]},
          { phase: "PHASE 10 : JOUR J", color: "bg-amber-600", light: "bg-amber-50", border: "border-amber-600", items: [
            { mission: "Exploitation & coordination terrain", referent: ["Équipe"] },
            { mission: "Relation client", referent: ["Lead", "Julien"], actions: "Identifier opportunités futures" },
            { mission: "Supervision si gros projet", referent: ["Cheffe d'équipe", "Simon", "Julien"] }
          ]},
          { phase: "PHASE 11 : CLÔTURE & FIDÉLISATION", color: "bg-slate-600", light: "bg-slate-50", border: "border-slate-600", items: [
            { mission: "Budget final & reporting", referent: ["Équipe"], actions: "Comparatif prévisionnel / réel" },
            { mission: "Clôture financière", referent: ["Marie"] },
            { mission: "REX interne", referent: ["Cheffe d'équipe", "Équipe", "Simon"], actions: "Identifier axes d’amélioration (y compris RSE)" },
            { mission: "REX client", referent: ["Lead", "Julien", "Simon"], actions: "Mesurer perception expérience" },
            { mission: "REX prestataire", referent: ["Équipe"] },
            { mission: "MAJ boites évent et inventaire", referent: ["Lead"] },
            { mission: "Demande avis Google", referent: ["Lead"] },
            { mission: "Relance commerciale & fidélisation. Opportunité future ?", referent: ["Julien"], ifNot: "⛔ Fin" },
            { mission: "Nouvelle demande", referent: ["Julien"] }
          ]}
        ];

        const allReferents = ["Julien", "Simon", "Pascal", "Marie", "Cheffe d'équipe", "Lead", "Équipe", "Client"];
        const projectTeamMembers = ["Cheffe d'équipe", "Lead", "Équipe"];

        // Color Mapping - Distinct colors per member
        const colorConfig = {
            "Julien": { bg: "bg-amber-500", light: "bg-amber-100", text: "text-amber-700", border: "border-amber-400" },
            "Simon": { bg: "bg-purple-500", light: "bg-purple-100", text: "text-purple-700", border: "border-purple-400" },
            "Pascal": { bg: "bg-rose-500", light: "bg-rose-100", text: "text-rose-700", border: "border-rose-400" },
            "Marie": { bg: "bg-emerald-500", light: "bg-emerald-100", text: "text-emerald-700", border: "border-emerald-400" },
            "Cheffe d'équipe": { bg: "bg-cyan-500", light: "bg-cyan-100", text: "text-cyan-700", border: "border-cyan-400" },
            "Lead": { bg: "bg-blue-500", light: "bg-blue-100", text: "text-blue-700", border: "border-blue-400" },
            "Équipe": { bg: "bg-slate-500", light: "bg-slate-100", text: "text-slate-700", border: "border-slate-400" },
            "Équipe projet": { bg: "bg-indigo-600", light: "bg-indigo-100", text: "text-indigo-700", border: "border-indigo-500" },
            "Client": { bg: "bg-slate-800", light: "bg-slate-200", text: "text-slate-800", border: "border-slate-500" }
        };

        // State management
        let currentView = 'process';
        let selectedPerson = 'Tous';
        let searchTerm = '';

        const personStats = {};
        allReferents.forEach(p => {
            let count = 0;
            rawData.forEach(phase => phase.items.forEach(item => { if (item.referent.includes(p)) count++; }));
            personStats[p] = count;
        });

        let projectTeamCount = 0;
        rawData.forEach(phase => {
            phase.items.forEach(item => {
                if (item.referent.some(r => projectTeamMembers.includes(r))) projectTeamCount++;
            });
        });

        // DOM Elements
        const contentArea = document.getElementById('content-area');
        const emptyState = document.getElementById('empty-state');
        const searchInput = document.getElementById('search-input');
        const referentFilters = document.getElementById('referent-filters');
        
        const btnProcess = document.getElementById('btn-process');
        const btnRoles = document.getElementById('btn-roles');
        const mBtnProcess = document.getElementById('mobile-btn-process');
        const mBtnRoles = document.getElementById('mobile-btn-roles');

        // Functions
        function updateViewButtons() {
            const activeClass = "bg-weevup shadow-lg text-white ring-4 ring-weevup/20";
            const inactiveClass = "text-slate-500 hover:text-weevup hover:bg-slate-100";
            
            btnProcess.className = `flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-black transition-all ${currentView === 'process' ? activeClass : inactiveClass}`;
            btnRoles.className = `flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-black transition-all ${currentView === 'roles' ? activeClass : inactiveClass}`;
            
            mBtnProcess.className = `flex flex-col items-center gap-1 ${currentView === 'process' ? 'text-weevup scale-110' : 'text-slate-400'}`;
            mBtnRoles.className = `flex flex-col items-center gap-1 ${currentView === 'roles' ? 'text-weevup scale-110' : 'text-slate-400'}`;
        }

        function renderFilters() {
            referentFilters.innerHTML = '';
            
            // TOUS
            const btnTous = document.createElement('button');
            btnTous.className = `px-4 py-2 rounded-xl text-xs font-black whitespace-nowrap transition-all ${selectedPerson === 'Tous' ? 'bg-slate-900 text-white shadow-lg scale-105' : 'bg-slate-200 text-slate-600 hover:bg-slate-300'}`;
            btnTous.innerText = 'TOUS';
            btnTous.onclick = () => { selectedPerson = 'Tous'; render(); };
            referentFilters.appendChild(btnTous);

            // ÉQUIPE PROJET
            const btnProject = document.createElement('button');
            const isSelectedProject = selectedPerson === 'Équipe projet';
            const projectColors = colorConfig["Équipe projet"];
            btnProject.className = `px-4 py-2 rounded-xl text-xs font-black whitespace-nowrap transition-all flex items-center gap-2 border-2 ${isSelectedProject ? projectColors.bg + ' text-white ' + projectColors.border + ' shadow-lg scale-105' : 'bg-white border-indigo-200 text-indigo-700 hover:bg-indigo-50'}`;
            btnProject.innerHTML = `ÉQUIPE PROJET <span class="px-2 py-0.5 rounded-lg text-[10px] ${isSelectedProject ? 'bg-white/20' : 'bg-indigo-100'}">${projectTeamCount}</span>`;
            btnProject.onclick = () => { selectedPerson = 'Équipe projet'; render(); };
            referentFilters.appendChild(btnProject);

            // Individual buttons
            allReferents.forEach(person => {
                const btn = document.createElement('button');
                const isSelected = selectedPerson === person;
                const colors = colorConfig[person];
                btn.className = `px-4 py-2 rounded-xl text-xs font-black whitespace-nowrap transition-all flex items-center gap-2 border-2 ${isSelected ? colors.bg + ' text-white ' + colors.border + ' shadow-lg scale-105' : colors.light + ' ' + colors.text + ' border-transparent hover:' + colors.border}`;
                btn.innerHTML = `${person.toUpperCase()} <span class="px-2 py-0.5 rounded-lg text-[10px] ${isSelected ? 'bg-white/20' : 'bg-white/50'}">${personStats[person] || 0}</span>`;
                btn.onclick = () => { selectedPerson = person; render(); };
                referentFilters.appendChild(btn);
            });
        }

        function render() {
            updateViewButtons();
            renderFilters();
            contentArea.innerHTML = '';
            
            const filteredData = rawData.map(phase => ({
                ...phase,
                items: phase.items.filter(item => {
                    let matchesPerson = false;
                    if (selectedPerson === 'Tous') {
                        matchesPerson = true;
                    } else if (selectedPerson === 'Équipe projet') {
                        matchesPerson = item.referent.some(r => projectTeamMembers.includes(r));
                    } else {
                        matchesPerson = item.referent.includes(selectedPerson);
                    }
                    const searchTermLower = searchTerm.toLowerCase();
                    const matchesSearch = item.mission.toLowerCase().includes(searchTermLower) || 
                                         (item.actions && item.actions.toLowerCase().includes(searchTermLower)) ||
                                         (item.ifNot && item.ifNot.toLowerCase().includes(searchTermLower));
                    return matchesPerson && matchesSearch;
                })
            })).filter(phase => phase.items.length > 0);

            if (filteredData.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                if (currentView === 'process') renderProcessView(filteredData);
                else renderRolesView(filteredData);
            }
            lucide.createIcons();
        }

        function renderProcessView(data) {
            const container = document.createElement('div');
            container.className = 'space-y-16 animate-fade-in';
            
            data.forEach((phase, idx) => {
                const phaseEl = document.createElement('div');
                phaseEl.className = 'relative pl-8 md:pl-0';
                phaseEl.innerHTML = `
                    <div class="absolute left-0 md:left-1/2 top-0 bottom-0 w-1 bg-slate-200 md:-translate-x-1/2 hidden md:block opacity-30"></div>
                    <div class="flex flex-col items-start md:items-center mb-10">
                        <div class="${phase.color} text-white px-8 py-3 rounded-2xl text-[11px] font-black tracking-[0.2em] uppercase z-10 shadow-xl ring-4 ring-white">
                            ${phase.phase}
                        </div>
                    </div>
                `;

                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-8 relative';
                
                phase.items.forEach((item, iIdx) => {
                    const itemEl = document.createElement('div');
                    const align = iIdx % 2 === 0 ? 'md:text-right' : 'md:text-left';
                    const flexDir = iIdx % 2 === 0 ? 'md:flex-row-reverse' : 'md:flex-row';
                    const justify = iIdx % 2 === 0 ? 'md:justify-end' : 'md:justify-start';

                    itemEl.className = `bg-white p-7 rounded-[2rem] border border-slate-200 shadow-sm hover:shadow-xl hover:border-slate-300 transition-all group relative overflow-hidden`;
                    
                    const content = `
                        <div class="flex items-center gap-4 mb-4 ${flexDir}">
                            <div class="w-12 h-12 rounded-2xl ${phase.light} flex items-center justify-center ${phase.color.replace('bg-', 'text-')} flex-shrink-0 shadow-inner">
                                <i data-lucide="target" class="w-6 h-6"></i>
                            </div>
                            <h4 class="font-black text-lg text-slate-800 leading-tight flex-1">${item.mission}</h4>
                        </div>
                        <div class="flex flex-wrap gap-2 mb-4 ${justify}">
                            ${item.referent.map(r => {
                                const colors = colorConfig[r] || colorConfig["Équipe"];
                                return `<span class="px-3 py-1 ${colors.bg} text-white rounded-lg text-[10px] font-black uppercase tracking-wider shadow-sm">${r}</span>`
                            }).join('')}
                        </div>
                        ${item.ifNot && item.ifNot !== '—' ? `
                            <div class="text-[11px] font-bold text-rose-600 bg-rose-50 p-3 rounded-xl border border-rose-100 mb-3 flex items-start gap-2 ${align}">
                                <i data-lucide="alert-circle" class="w-4 h-4 flex-shrink-0 mt-0.5"></i>
                                <div class="flex-1 text-left"><span class="uppercase tracking-wide opacity-70 text-[9px] block mb-0.5">Si NON</span>${item.ifNot}</div>
                            </div>
                        ` : ''}
                        ${item.actions && item.actions !== '—' ? `
                            <div class="text-[12px] font-medium text-slate-500 leading-relaxed bg-slate-50 p-4 rounded-2xl border-l-4 ${phase.border} italic ${align}">
                                ${item.actions}
                            </div>
                        ` : ''}
                    `;
                    itemEl.innerHTML = content;
                    grid.appendChild(itemEl);
                });

                phaseEl.appendChild(grid);
                container.appendChild(phaseEl);
            });
            contentArea.appendChild(container);
        }

        function renderRolesView(data) {
            const container = document.createElement('div');
            container.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-10 animate-fade-in';
            
            let entities = selectedPerson === 'Tous' ? [...allReferents, "Équipe projet"] : [selectedPerson];
            
            entities.forEach(entity => {
                const missions = [];
                data.forEach(phase => {
                    const matches = phase.items.filter(item => {
                        if (entity === "Équipe projet") return item.referent.some(r => projectTeamMembers.includes(r));
                        return item.referent.includes(entity);
                    });
                    matches.forEach(item => missions.push({ 
                        phase: phase.phase.split(':')[0], 
                        mission: item.mission, 
                        actions: item.actions,
                        ifNot: item.ifNot,
                        color: phase.color,
                        light: phase.light,
                        border: phase.border
                    }));
                });

                if (missions.length === 0) return;

                const colors = colorConfig[entity] || colorConfig["Équipe"];
                const cardEl = document.createElement('div');
                cardEl.className = `bg-white rounded-[2.5rem] border-2 border-slate-200 shadow-sm overflow-hidden flex flex-col hover:shadow-2xl transition-all duration-300`;
                
                cardEl.innerHTML = `
                    <div class="${colors.bg} p-8 flex items-center justify-between relative overflow-hidden">
                        <div class="absolute right-0 top-0 opacity-10 -rotate-12 translate-x-4 -translate-y-4">
                            <i data-lucide="${entity === "Équipe projet" ? 'rocket' : 'user'}" class="w-32 h-32 text-white"></i>
                        </div>
                        <div class="flex items-center gap-5 z-10">
                            <div class="w-16 h-16 bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center text-white font-black text-2xl shadow-xl">
                                ${entity === "Équipe projet" ? '<i data-lucide="rocket" class="w-8 h-8"></i>' : entity.charAt(0)}
                            </div>
                            <div>
                                <h3 class="text-white font-black text-2xl uppercase tracking-tight">${entity}</h3>
                                <div class="bg-black/20 px-3 py-1 rounded-full inline-block mt-1">
                                    <p class="text-white text-[10px] font-black uppercase tracking-widest">
                                        ${entity === "Équipe projet" ? "Vision consolidée" : (personStats[entity] || 0) + " Missions"}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-8 space-y-6 flex-1 bg-slate-50/30">
                        ${missions.map(m => `
                            <div class="group p-6 bg-white rounded-3xl border border-slate-100 shadow-sm hover:border-slate-300 transition-all relative">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-[10px] font-black uppercase text-white px-3 py-1 rounded-xl ${m.color}">
                                        ${m.phase}
                                    </span>
                                </div>
                                <p class="font-black text-slate-900 text-base mb-2">${m.mission}</p>
                                ${m.ifNot && m.ifNot !== '—' ? `
                                    <div class="text-[11px] font-bold text-rose-600 bg-rose-50 p-2.5 rounded-lg border border-rose-100 mb-2 flex items-start gap-2">
                                        <i data-lucide="alert-circle" class="w-4 h-4 flex-shrink-0 mt-0.5"></i>
                                        <div class="text-left"><span class="uppercase tracking-wide opacity-70 text-[9px] block mb-0.5">Si NON</span>${m.ifNot}</div>
                                    </div>
                                ` : ''}
                                ${m.actions && m.actions !== '—' ? `<p class="text-[12px] text-slate-500 font-medium italic leading-snug p-4 bg-slate-50 rounded-2xl border-l-4 ${m.border}">${m.actions}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(cardEl);
            });
            contentArea.appendChild(container);
        }

        // Event Listeners
        searchInput.oninput = (e) => { searchTerm = e.target.value; render(); };
        btnProcess.onclick = () => { currentView = 'process'; render(); };
        btnRoles.onclick = () => { currentView = 'roles'; render(); };
        mBtnProcess.onclick = () => { currentView = 'process'; render(); };
        mBtnRoles.onclick = () => { currentView = 'roles'; render(); };

        window.onload = render;
    </script>
</body>
</html>
